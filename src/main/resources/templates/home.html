<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security" lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Home</title>
  <link rel="stylesheet" th:href="@{/css/headerstyle.css}">
  <link rel="stylesheet" th:href="@{/css/menustyle.css}">
  <link rel="stylesheet" th:href="@{/css/AvaterStyle.css}">
  <link rel="stylesheet" th:href="@{/css/loginStyle.css}">
  <style>
    .layout-shell { display:block; }
    .with-admin { display:flex; }
    .no-admin { display:block; }
    .main-content { width:100%; margin-left:0; }
    .main-content-inner { max-width: 1200px; margin: 0 auto; padding: 0 16px; }
    .with-sidebar { margin-left:240px; }
    @media (max-width: 1024px) {
      .with-sidebar { margin-left:0 !important; }
    }

    .page-product-results { background:#f6f7fb; min-height:100vh; padding-bottom:24px; }
    .section-product-grid { padding:16px; }
    .card-grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(260px,1fr)); gap:14px; }
    .product-info-card { box-shadow:0 6px 16px rgba(0,0,0,0.06); border-radius:12px; background:#fff; overflow:hidden; }
    .noimage, .placeholder { border-top-left-radius:12px; border-top-right-radius:12px; }
    .goal-body { padding:12px 14px 16px; display:flex; flex-direction:column; gap:8px; height:100%; }
    .goal-actions { margin-left:auto; }
    .filter-box { display:flex; gap:8px; align-items:flex-end; flex-wrap:wrap; }
    .filter-actions { display:flex; gap:8px; flex-wrap:wrap; }
    @media (max-width: 1024px) {
      .card-grid { grid-template-columns:repeat(auto-fill,minmax(200px,1fr)); }
      .filter-box { flex-direction:column; align-items:flex-start; }
    }
  </style>
</head>
<body>
<div class="layout-shell" th:classappend="${#authorization.expression('hasRole(''ADMIN'')') ? ' with-admin' : ' no-admin'}">
  <div sec:authorize="hasRole('ADMIN')" th:replace="fragments/admin-sidebar :: adminSidebar"></div>

  <div class="main-content" th:classappend="${#authorization.expression('hasRole(''ADMIN'')') ? 'with-sidebar' : ''}">
    <div class="main-content-inner">
      <div th:replace="fragments/header :: commonHeader"></div>

      <div class="page-product-results">
        <div class="section-product-grid">
          <div class="filter-bar">
            <form method="get" action="/home" class="filter-box">
              <div>
                <label for="tech" class="label" style="margin:0;">기술 필터</label>
                <select id="tech" name="tech" class="input" multiple size="4" style="min-width:180px;">
                  <option th:each="tech : ${techList}"
                          th:value="${tech.name}"
                          th:text="${tech.name}"
                          th:selected="${selectedTech != null and selectedTech.contains(tech.name)}">Tech</option>
                </select>
              </div>
              <div>
                <label for="q" class="label" style="margin:0;">키워드</label>
                <input type="text" id="q" name="q" th:value="${keyword}" class="input" placeholder="제목/설명/기술 검색" style="min-width:180px;" />
              </div>
              <div class="filter-actions">
                <button type="submit" class="button2 button">필터 적용</button>
                <a href="/home" class="button3 button4">필터 해제</a>
              </div>
            </form>
          </div>

          <div class="card-grid">
            <div th:each="portfolio : ${portfolios}" class="product-info-card goal-card" style="display:flex; flex-direction:column; text-decoration: none;">
              <div
                      class="noimage"
                      th:if="${portfolio.imageUrl != null and !#strings.isEmpty(portfolio.imageUrl)}"
                      th:style="|background-image: url('${portfolio.imageUrl}'); min-height:200px; background-size:cover; background-position:center;|">
              </div>

              <div
                      class="noimage placeholder"
                      th:if="${portfolio.imageUrl == null or #strings.isEmpty(portfolio.imageUrl)}"
                      th:style="|background: ${portfolio.randomColor} !important; min-height:200px;|">
              </div>

              <div class="goal-body" style="display:flex; flex-direction:column; gap:6px;">
                <h3 class="goal-title" th:text="${portfolio.title}">포트폴리오 제목</h3>
                <div class="goal-meta" style="display:flex; gap:8px; flex-wrap:wrap;">
                  <span class="goal-category" th:text="${portfolio.techStack}">사용 기술</span>
                </div>
                <p class="goal-description" th:text="${portfolio.description}">프로젝트 설명</p>
                <div class="goal-links" style="display:flex; gap:8px; flex-wrap:wrap;">
                  <a th:if="${portfolio.projectLink}" th:href="${portfolio.projectLink}" target="_blank" rel="noopener" class="title2">프로젝트 링크</a>
                  <a th:if="${portfolio.extraUrl}" th:href="${portfolio.extraUrl}" target="_blank" rel="noopener" class="title2">기타 링크</a>
                </div>
                <div style="display:flex; gap:8px; flex-wrap:wrap; margin-top:auto;">
                  <a th:href="@{/portfolios/{id}(id=${portfolio.id})}" class="button button2">상세보기</a>
                  <div sec:authorize="hasRole('ADMIN')" class="goal-actions" style="display:flex; gap:8px;">
                    <a th:href="@{/portfolios/{id}/edit(id=${portfolio.id})}" class="button button2 edit">Edit</a>
                    <a th:href="@{/portfolios/{id}/delete(id=${portfolio.id})}" class="button3 button4 delete">Delete</a>
                  </div>
                </div>
              </div>
            </div>
          </div>

        </div>
      </div>
    </div>
  </div>
</div>
</body>
</html>
